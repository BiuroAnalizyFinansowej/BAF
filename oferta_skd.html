<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oferta SKD - Podsumowanie</title>
    <link rel="icon" type="image/png" href="baf_logo_p.png">
    
    <style>
        #controls-container { position: fixed; top: 20px; right: 30px; z-index: 1000; width: 280px; font-family: 'Lato', Arial, sans-serif; }
        
        #copyButton {
            padding: 10px 15px;
            font-size: 16px;
            font-weight: bold;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            outline: none;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: background-color 0.3s ease, transform 0.2s ease;
            width: 100%;
        }
        #copyButton:active { transform: scale(0.98); }

        #copyButton { background-color: #17a2b8; }
        #copyButton:hover { background-color: #138496; }
        #copyButton.copied { background-color: #28a745; }
        
        .data-placeholder {
            display: inline-block;
            background-color: #eee;
            color: #eee;
            border-radius: 4px;
            min-width: 80px;
        }
    </style>
</head>
<body style="margin: 0; padding: 0; background-color: #f4f7f9; font-family: 'Lato', Arial, sans-serif;">

    <div id="controls-container">
        <button id="copyButton">Kopiuj tre≈õƒá oferty</button>
    </div>
    
    <div id="email-content-wrapper">
        <table border="0" cellpadding="0" cellspacing="0" width="100%" role="presentation" style="background-color: #f4f7f9;">
            <tr>
                <td align="center">
                    <table border="0" cellpadding="0" cellspacing="0" width="100%" role="presentation" style="max-width: 800px;">
                        <tr>
                            <td align="center" style="background-color: #002d5a; padding: 40px 20px;">
                                 <div style="font-family: 'Montserrat', sans-serif; text-align: center;">
                                     <div style="font-size: 60px; font-weight: 700; color: #ffffff; position: relative; letter-spacing: -10px; line-height: 1;">
                                         <span style="position: relative; z-index: 1;">B</span><span style="position: relative; z-index: 2;">A</span><span style="position: relative; z-index: 1;">F</span>
                                     </div>
                                     <div style="font-family: 'Roboto', sans-serif; font-size: 14px; color: #ffffff; letter-spacing: 1px; margin-top: 8px; text-align: center;">
                                         BIURO ANALIZY FINANSOWEJ
                                     </div>
                                 </div>
                            </td>
                        </tr>
                        <tr>
                            <td style="background-color: #ffffff; padding: 40px 50px;">
                                <h1 style="font-family: 'Lato', Arial, sans-serif; font-size: 28px; font-weight: 400; color: #002d5a; margin: 0 0 25px 0;">Dzie≈Ñ dobry,</h1>
                                <p style="font-family: 'Lato', Arial, sans-serif; font-size: 17px; color: #555; margin: 0 0 20px 0; line-height: 1.6;">
                                    w nawiƒÖzaniu do naszej rozmowy na temat <strong>Sankcji Kredytu Darmowego</strong> (SKD), przesy≈Çam przygotowanƒÖ kalkulacjƒô i podsumowanie finansowe.
                                </p>
                                
                                <table border="0" cellpadding="0" cellspacing="0" width="100%" role="presentation" style="margin-bottom: 30px; margin-top: 20px; border-spacing: 0;">
                                    <tr>
                                        <td>
                                            <h2 style="font-family: 'Lato', Arial, sans-serif; font-size: 26px; color: #004d99; border-bottom: 2px solid #007bff; padding-bottom: 10px; margin: 0 0 25px 0; font-weight: 700;">Proces w 4 prostych krokach</h2>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <table border="0" cellpadding="0" cellspacing="0" width="100%" role="presentation" style="border-spacing: 8px 0; margin: 0 -8px;">
                                                <tr style="vertical-align: top;">
                                                    
                                                    <td width="25%" style="padding: 0; vertical-align: top;">
                                                        <div style="background-color: #f8faff; border: 1px solid #dee2e6; border-radius: 8px; padding: 20px 15px; text-align: center; min-height: 190px;">
                                                            <div style="font-size: 30px; line-height: 1.2; margin-bottom: 10px;">‚úçÔ∏è</div>
                                                            <h3 style="font-family: 'Lato', Arial, sans-serif; font-size: 17px; color: #333; margin: 0 0 8px 0; font-weight: 700; white-space: nowrap;">Krok 1: Umowa</h3>
                                                            <p style="font-family: 'Lato', Arial, sans-serif; font-size: 15px; color: #555; margin: 0; line-height: 1.5;">Podpisanie umowy i start sprawy.</p>
                                                        </div>
                                                    </td>
                                                    
                                                    <td width="25%" style="padding: 0; vertical-align: top;">
                                                        <div style="background-color: #f8faff; border: 1px solid #dee2e6; border-radius: 8px; padding: 20px 15px; text-align: center; min-height: 190px;">
                                                            <div style="font-size: 30px; line-height: 1.2; margin-bottom: 10px;">‚öñÔ∏è</div>
                                                            <h3 style="font-family: 'Lato', Arial, sans-serif; font-size: 17px; color: #333; margin: 0 0 8px 0; font-weight: 700; white-space: nowrap;">Krok 2: Pozew</h3>
                                                            <p style="font-family: 'Lato', Arial, sans-serif; font-size: 15px; color: #555; margin: 0; line-height: 1.5;">Reprezentacja w sƒÖdzie.</p>
                                                        </div>
                                                    </td>
                                                    
                                                    <td width="25%" style="padding: 0; vertical-align: top;">
                                                        <div style="background-color: #f8faff; border: 1px solid #dee2e6; border-radius: 8px; padding: 20px 15px; text-align: center; min-height: 190px;">
                                                            <div style="font-size: 30px; line-height: 1.2; margin-bottom: 10px;">üèÜ</div>
                                                            <h3 style="font-family: 'Lato', Arial, sans-serif; font-size: 17px; color: #333; margin: 0 0 8px 0; font-weight: 700; white-space: nowrap;">Krok 3: Wygrana</h3>
                                                            <p style="font-family: 'Lato', Arial, sans-serif; font-size: 15px; color: #555; margin: 0; line-height: 1.5;">Doprowadzenie do korzystnego wyroku.</p>
                                                        </div>
                                                    </td>
                                                    
                                                    <td width="25%" style="padding: 0; vertical-align: top;">
                                                        <div style="background-color: #f8faff; border: 1px solid #dee2e6; border-radius: 8px; padding: 20px 15px; text-align: center; min-height: 190px;">
                                                            <div style="font-size: 30px; line-height: 1.2; margin-bottom: 10px;">üí∞</div>
                                                            <h3 style="font-family: 'Lato', Arial, sans-serif; font-size: 17px; color: #333; margin: 0 0 8px 0; font-weight: 700; white-space: nowrap;">Krok 4: PieniƒÖdze</h3>
                                                            <p style="font-family: 'Lato', Arial, sans-serif; font-size: 15px; color: #555; margin: 0; line-height: 1.5;">≈örodki trafiajƒÖ na konto.</p>
                                                        </div>
                                                    </td>
                                                    
                                                </tr>
                                            </table>
                                        </td>
                                    </tr>
                                </table>
                                
                                <table border="0" cellpadding="0" cellspacing="0" width="100%" role="presentation" style="margin-bottom: 20px;">
                                    <tr>
                                        <td>
                                            <h2 style="font-family: 'Lato', Arial, sans-serif; font-size: 26px; color: #004d99; border-bottom: 2px solid #007bff; padding-bottom: 10px; margin: 0 0 25px 0; font-weight: 700;">Kalkulacja finansowa</h2>
                                            <div style="background: #f8faff; border-left: 4px solid #007bff; padding: 20px; border-radius: 4px; font-size: 1em;">
                                                <table border="0" cellpadding="0" cellspacing="0" width="100%" role="presentation" style="font-family: 'Lato', Arial, sans-serif; font-size: 16px; color: #555; line-height: 1.9;">
                                                    <tr style="border-bottom: 1px solid #dee2e6;">
                                                        <td style="padding: 10px 0; font-weight: 700;">WPS (Warto≈õƒá Przedmiotu Sporu)</td>
                                                        <td style="padding: 10px 0; text-align: right; font-weight: 700; color: #333;"><span id="data-wps" class="data-placeholder">...</span></td>
                                                    </tr>
                                                    <tr style="border-bottom: 1px solid #dee2e6;">
                                                        <td style="padding: 10px 0; font-weight: 700;">
                                                            Sumarycznie do odzyskania
                                                            <br>
                                                            <span style="font-weight: normal;">(WPS + odsetki za op√≥≈∫nienie + umorzone odsetki)</span>
                                                        </td>
                                                        <td style="padding: 10px 0; text-align: right; font-weight: 700; font-size: 18px; color: #0056b3; vertical-align: middle;"><span id="data-sum_do_odzyskania" class="data-placeholder">...</span></td>
                                                    </tr>
                                                    <tr style="border-bottom: 1px solid #dee2e6;">
                                                        <td style="padding: 10px 0;">Sumaryczne Pre op≈Çaty (brutto)</td>
                                                        <td style="padding: 10px 0; text-align: right;"><span id="data-sum_pre_brutto" class="data-placeholder">...</span></td>
                                                    </tr>
                                                    <tr style="border-bottom: 1px solid #dee2e6;">
                                                        <td style="padding: 10px 0; vertical-align: top;">
                                                            Op≈Çata za II instancjƒô (brutto)
                                                            <div style="font-size: 13px; color: #777; font-style: italic; font-weight: normal; padding-top: 4px; line-height: 1.4;">
                                                                (je≈õli sprawa nie zako≈Ñczy siƒô na I instancji)
                                                            </div>
                                                        </td>
                                                        <td style="padding: 10px 0; text-align: right; vertical-align: top;"><span id="data-ii_instancja_brutto" class="data-placeholder">...</span></td>
                                                    </tr>
                                                    <tr style="border-bottom: 1px solid #dee2e6;">
                                                        <td style="padding: 10px 0;">Prognozowane Success Fee (brutto)</td>
                                                        <td style="padding: 10px 0; text-align: right;"><span id="data-sum_sf_brutto" class="data-placeholder">...</span></td>
                                                    </tr>
                                                    <tr style="border-bottom: 1px solid #dee2e6;">
                                                        <td style="padding: 10px 0; font-weight: 700;">Zysk Klienta po rozliczeniu inwestycji</td>
                                                        <td style="padding: 10px 0; text-align: right; font-weight: 700; font-size: 18px; color: #155724;"><span id="data-zysk_klienta" class="data-placeholder">...</span></td>
                                                    </tr>
                                                </table>
                                            </div>
                                            
                                            <div style="background: #f8f9fa; padding: 20px; border-radius: 4px; font-size: 1em; margin-top: 20px;">
                                                <table border="0" cellpadding="0" cellspacing="0" width="100%" role="presentation" style="font-family: 'Lato', Arial, sans-serif; font-size: 16px; color: #555; line-height: 1.8;">
                                                    <tr style="border-bottom: 1px solid #dee2e6;">
                                                        <td style="padding: 8px 0; font-weight: 700;">Stopa zwrotu z inwestycji (ROI)</td>
                                                        <td style="padding: 8px 0; text-align: right; font-weight: 700; color: #155724;"><span id="data-roi" class="data-placeholder">...</span></td>
                                                    </tr>
                                                    <tr style="border-bottom: 1px solid #dee2e6;">
                                                        <td style="padding: 8px 0;">Stosunek pre op≈Çat do sumy odzyskania</td>
                                                        <td style="padding: 8px 0; text-align: right; font-weight: 700;"><span id="data-stosunek_pre_do_sumy" class="data-placeholder">...</span></td>
                                                    </tr>
                                                     <tr style="border-bottom: 1px solid #dee2e6;">
                                                        <td style="padding: 8px 0;">Podzia≈Ç procentowy dla Klienta</td>
                                                        <td style="padding: 8px 0; text-align: right; font-weight: 700; color: #155724;"><span id="data-podzial_klient" class="data-placeholder">...</span></td>
                                                    </tr>
                                                    <tr>
                                                        <td style="padding: 8px 0;">Podzia≈Ç procentowy dla BAF</td>
                                                        <td style="padding: 8px 0; text-align: right; font-weight: 700; color: #0056b3;"><span id="data-podzial_nasz" class="data-placeholder">...</span></td>
                                                    </tr>
                                                </table>
                                            </div>
                                            
                                            <div style="width: 100%; max-width: 400px; margin: 30px auto 10px auto; position: relative; text-align: center;">
                                                <h3 style="font-family: 'Lato', Arial, sans-serif; font-size: 20px; color: #004d99; font-weight: 700; text-align: center; margin-bottom: 15px;">Prognozowany podzia≈Ç zysku</h3>
                                                <img id="profitSplitChartImage" src="" alt="Wykres podzia≈Çu zysku" style="max-width: 100%; height: auto;">
                                            </div>
                                            
                                        </td>
                                    </tr>
                                </table>
                                
                                <table border="0" cellpadding="0" cellspacing="0" width="100%" role="presentation" style="margin-bottom: 20px;">
                                    <tr>
                                        <td>
                                            <h2 style="font-family: 'Lato', Arial, sans-serif; font-size: 26px; color: #004d99; border-bottom: 2px solid #007bff; padding-bottom: 10px; margin: 0 0 25px 0; font-weight: 700;">Opcje ratalne (PAYU)</h2>
                                            <p style="font-family: 'Lato', Arial, sans-serif; font-size: 17px; color: #555; margin: 0 0 20px 0; line-height: 1.6;">
                                                Poni≈ºsza tabela przedstawia opcje roz≈Ço≈ºenia na raty kwoty <strong>Sumarycznych Pre op≈Çat (<span id="data-sum_pre_brutto_2" class="data-placeholder">...</span>)</strong>.
                                            </p>
                                            
                                            <table border="0" cellpadding="0" cellspacing="0" width="100%" role="presentation" style="font-family: 'Lato', Arial, sans-serif; font-size: 16px; color: #555; border-collapse: collapse; border: 1px solid #dee2e6;">
                                                <thead>
                                                    <tr style="background-color: #f8f9fa;">
                                                        <th style="padding: 12px 15px; text-align: left; border-bottom: 2px solid #007bff;">Liczba rat</th>
                                                        <th style="padding: 12px 15px; text-align: right; border-bottom: 2px solid #007bff;">Miesiƒôczna rata (brutto)</th>
                                                        <th style="padding: 12px 15px; text-align: right; border-bottom: 2px solid #007bff;">Prowizja PAYU</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr style="border-bottom: 1px solid #dee2e6;">
                                                        <td style="padding: 12px 15px; font-weight: 700;">5 rat</td>
                                                        <td style="padding: 12px 15px; text-align: right; font-weight: 700; color: #333;"><span id="data-payu_rata_5" class="data-placeholder">...</span></td>
                                                        <td style="padding: 12px 15px; text-align: right; font-weight: 700; color: #c0392b;"><span id="data-payu_prowizja_5" class="data-placeholder">...</span></td>
                                                    </tr>
                                                    <tr style="border-bottom: 1px solid #dee2e6;">
                                                        <td style="padding: 12px 15px; font-weight: 700;">10 rat</td>
                                                        <td style="padding: 12px 15px; text-align: right; font-weight: 700; color: #333;"><span id="data-payu_rata_10" class="data-placeholder">...</span></td>
                                                        <td style="padding: 12px 15px; text-align: right; font-weight: 700; color: #c0392b;"><span id="data-payu_prowizja_10" class="data-placeholder">...</span></td>
                                                    </tr>
                                                    <tr>
                                                        <td style="padding: 12px 15px; font-weight: 700;">20 rat</td>
                                                        <td style="padding: 12px 15px; text-align: right; font-weight: 700; color: #333;"><span id="data-payu_rata_20" class="data-placeholder">...</span></td>
                                                        <td style="padding: 12px 15px; text-align: right; font-weight: 700; color: #c0392b;"><span id="data-payu_prowizja_20" class="data-placeholder">...</span></td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </td>
                                    </tr>
                                </table>
                                
                                <p style="font-family: 'Lato', Arial, sans-serif; font-size: 17px; color: #555; margin: 30px 0 0 0; line-height: 1.6;">
                                    Czekam na informacjƒô zwrotnƒÖ. W razie pyta≈Ñ jestem do dyspozycji mailowo i pod telefonem.
                                </p>
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
        </table>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Lista kluczy danych do pobrania
            const dataKeys = [
                'wps', 'sum_pre_brutto', 'ii_instancja_brutto', 'sum_do_odzyskania',
                'zysk_klienta', 'roi', 'stosunek_pre_do_sumy', 'sum_sf_brutto', 
                'podzial_klient', 'podzial_nasz', 'payu_rata_5', 
                'payu_rata_10', 'payu_rata_20',
                'payu_prowizja_5', 'payu_prowizja_10', 'payu_prowizja_20'
            ];
            
            let clientPercentValue = 0;
            let firmPercentValue = 0;

            // Pƒôtla do pobierania danych i wstawiania ich do HTML
            dataKeys.forEach(key => {
                const value = sessionStorage.getItem(`skd_data_${key}`);
                
                if (value) {
                    const element = document.getElementById(`data-${key}`);
                    if (element) {
                        element.textContent = value;
                        element.classList.remove('data-placeholder');
                    }
                    
                    if (key === 'podzial_klient') {
                        // Usuniƒôcie spacji separatora (na wszelki wypadek) i zamiana przecinka
                        clientPercentValue = parseFloat(value.replace(/\s/g, '').replace('%', '').replace(',', '.')) || 0;
                    } else if (key === 'podzial_nasz') {
                        firmPercentValue = parseFloat(value.replace(/\s/g, '').replace('%', '').replace(',', '.')) || 0;
                    }
                } else {
                     console.warn(`Nie znaleziono danych w sessionStorage dla klucza: ${key}`);
                }
            });
            
            const sumPreBrutto = sessionStorage.getItem('skd_data_sum_pre_brutto');
            if(sumPreBrutto) {
                 const element2 = document.getElementById('data-sum_pre_brutto_2');
                 element2.textContent = sumPreBrutto;
                 element2.classList.remove('data-placeholder');
            }

            // Logika kopiowania
            const copyBtn = document.getElementById('copyButton');
            const emailWrapper = document.getElementById('email-content-wrapper');
            copyBtn.addEventListener('click', () => {
                const htmlContent = emailWrapper.innerHTML;
                const blob = new Blob([htmlContent], { type: 'text/html' });
                const richTextInput = new ClipboardItem({ 'text/html': blob });
                
                navigator.clipboard.write([richTextInput]).then(() => {
                    copyBtn.textContent = 'Skopiowano tre≈õƒá';
                    copyBtn.classList.add('copied');
                    setTimeout(() => {
                        copyBtn.textContent = 'Kopiuj tre≈õƒá oferty';
                        copyBtn.classList.remove('copied');
                    }, 2000);
                }).catch(err => {
                    console.error('B≈ÇƒÖd kopiowania: ', err);
                    copyBtn.textContent = 'B≈ÇƒÖd!';
                     setTimeout(() => {
                        copyBtn.textContent = 'Kopiuj tre≈õƒá oferty';
                    }, 2000);
                });
            });
            
            
            // Logika generowania obrazka wykresu
            try {
                // Konfiguracja wykresu
                const chartConfig = {
                    type: 'doughnut',
                    data: {
                        labels: [
                            `Zysk Klienta (${clientPercentValue.toFixed(2).replace('.', ',')}%)`, 
                            `Zysk BAF (${firmPercentValue.toFixed(2).replace('.', ',')}%)` // ZMIENIONE Z KANCELARII
                        ],
                        datasets: [{
                            data: [clientPercentValue, firmPercentValue],
                            backgroundColor: [
                                '#155724', 
                                '#0056b3'
                            ],
                            borderColor: '#ffffff',
                            borderWidth: 3
                        }]
                    },
                    options: {
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    font: {
                                        family: "'Lato', Arial, sans-serif",
                                        size: 14,
                                        color: '#333'
                                    }
                                }
                            },
                            datalabels: {
                                display: true,
                                color: 'white',
                                font: {
                                    weight: 'bold',
                                    size: 16
                                },
                                formatter: (value) => {
                                    return value.toFixed(1).replace('.', ',') + '%';
                                }
                            }
                        },
                        cutout: '60%'
                    }
                };
                
                // Budowanie URL dla quickchart.io
                const chartUrl = `https://quickchart.io/chart?width=400&height=250&backgroundColor=rgb(255,255,255)&chart=${encodeURIComponent(JSON.stringify(chartConfig))}`;
                
                const chartImage = document.getElementById('profitSplitChartImage');
                if (chartImage) {
                    chartImage.src = chartUrl;
                } else {
                    console.error("Nie znaleziono elementu <img> dla wykresu.");
                }

            } catch (e) {
                console.error("B≈ÇƒÖd podczas generowania URL wykresu:", e);
                const chartImage = document.getElementById('profitSplitChartImage');
                if(chartImage) chartImage.style.display = 'none';
            }
            
        });
    </script>
</body>
</html>
