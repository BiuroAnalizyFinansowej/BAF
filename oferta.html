<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oferta Finansowania - BAF</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap');
        body { margin: 0; padding: 0; background-color: #f4f7f9; font-family: 'Lato', Arial, sans-serif; }
        
        #control-panel-left {
            position: fixed; top: 20px; left: 20px; width: 220px; background: #ffffff;
            padding: 20px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); z-index: 1000;
        }
        .panel-btn {
            display: block; width: 100%; padding: 12px; margin-bottom: 8px; border: none; border-radius: 5px;
            cursor: pointer; font-size: 13px; font-weight: bold; text-align: center; transition: all 0.3s ease;
            background-color: #17a2b8; color: white; font-family: Arial, sans-serif;
        }
        .panel-btn:hover { background-color: #138496; }
        .panel-btn.copied { background-color: #28a745; }
        .back-link { display: block; text-align: center; margin-top: 10px; color: #555; text-decoration: none; font-size: 12px; }
        
        #email-content-wrapper { margin: 0 auto; padding: 20px 0 20px 260px; max-width: 900px; }
        
        @media (max-width: 1200px) {
            #control-panel-left { position: relative; top: 0; left: 0; width: auto; margin: 20px; }
            #email-content-wrapper { padding: 0 20px; margin: 0; }
        }
    </style>
</head>
<body>

    <div id="control-panel-left">
        <button id="copy-button" class="panel-btn">Kopiuj całość do maila</button>
        <div style="font-size: 11px; color: #777; margin-top: 10px; text-align: center;">
            Kliknij, aby skopiować gotowy szablon.
        </div>
        <a href="generator_oferty.html" class="back-link">« Wróć do generatora</a>
    </div>

    <div id="email-content-wrapper">
        <table border="0" cellpadding="0" cellspacing="0" width="100%" style="font-family: 'Lato', Arial, sans-serif; background-color: #f4f7f9; color: #333333;">
            <tr>
                <td align="center" style="padding: 20px;">
                    
                    <table border="0" cellpadding="0" cellspacing="0" width="100%" style="max-width: 900px; background-color: #ffffff; border-radius: 12px; overflow: hidden; box-shadow: 0 10px 30px rgba(0, 77, 153, 0.1); border: 1px solid #e1e4e8;">
                        <tr>
                            <td align="center" style="padding: 30px 0; background-color: #ffffff; border-bottom: 1px solid #f0f0f0;">
                                <img src="baf_logo.png" alt="Biuro Analizy Finansowej" width="250" style="display: block; width: 250px; max-width: 100%; height: auto; border: 0;">
                            </td>
                        </tr>
                        <tr>
                            <td style="padding: 40px 50px;">
                                
                                <h1 id="client-greeting" style="color: #002d5a; font-size: 28px; margin: 0 0 25px 0; font-weight: 700; font-family: 'Lato', Arial, sans-serif;">Panie Kamilu,</h1>
                                
                                <p id="intro-paragraph" style="font-size: 17px; color: #555555; margin-bottom: 25px; line-height: 1.6;">
                                    </p>

                                <div style="border-bottom: 1px solid #e0e0e0; padding-bottom: 30px; margin-bottom: 40px;">
                                    <h2 style="font-size: 24px; color: #004d99; border-bottom: 2px solid #007bff; padding-bottom: 10px; margin-bottom: 25px; font-weight: 700; margin-top: 0;">Rodzaj Finansowania: Kredyt firmowy ratalny</h2>

                                    <table border="0" cellpadding="0" cellspacing="0" width="100%">
                                        <tr>
                                            <td valign="top" width="48%" style="background-color: #fdfdfd; border: 1px solid #dcebf7; border-top: 4px solid #007bff; border-radius: 8px; padding: 25px; box-shadow: 0 4px 15px rgba(0, 77, 153, 0.05);">
                                                <h3 id="h3-var1" style="margin-top: 0; font-size: 20px; color: #0056b3; text-align: center; margin-bottom: 20px; font-weight: 700;">I WARIANT</h3>
                                                <table border="0" cellpadding="0" cellspacing="0" width="100%" style="font-size: 15px;">
                                                    <tr>
                                                        <td style="padding: 8px 0; border-bottom: 1px solid #eee; color: #666;">Kwota Netto:</td>
                                                        <td align="right" style="padding: 8px 0; border-bottom: 1px solid #eee; font-weight: 700; color: #333;" id="w1-net"></td>
                                                    </tr>
                                                    <tr>
                                                        <td style="padding: 8px 0; border-bottom: 1px solid #eee; color: #666;">Kwota Brutto:</td>
                                                        <td align="right" style="padding: 8px 0; border-bottom: 1px solid #eee; font-weight: 700; color: #333;" id="w1-gross"></td>
                                                    </tr>
                                                    <tr>
                                                        <td style="padding: 8px 0; border-bottom: 1px solid #eee; color: #666;">Prowizja bankowa:</td>
                                                        <td align="right" style="padding: 8px 0; border-bottom: 1px solid #eee; font-weight: 700; color: #333;" id="w1-prov"></td>
                                                    </tr>
                                                    <tr>
                                                        <td style="padding: 8px 0; border-bottom: 1px solid #eee; color: #666;">Marża banku:</td>
                                                        <td align="right" style="padding: 8px 0; border-bottom: 1px solid #eee; font-weight: 700; color: #333;" id="w1-margin"></td>
                                                    </tr>
                                                    <tr>
                                                        <td style="padding: 8px 0; border-bottom: 1px solid #eee; color: #666;">WIBOR 1M:</td>
                                                        <td align="right" style="padding: 8px 0; border-bottom: 1px solid #eee; font-weight: 700; color: #333;" class="wibor-val"></td>
                                                    </tr>
                                                    <tr>
                                                        <td style="padding: 10px 0; border-top: 1px solid #ddd; color: #666; font-weight: 700;">Oprocentowanie:</td>
                                                        <td align="right" style="padding: 10px 0; border-top: 1px solid #ddd; font-weight: 700; color: #333;" id="w1-rate"></td>
                                                    </tr>
                                                </table>
                                                <div style="background-color: #f0f7ff; border: 1px solid #cce5ff; border-radius: 6px; padding: 15px; margin-top: 20px; text-align: center;">
                                                    <span style="display: block; font-size: 22px; font-weight: 700; color: #004d99; margin-bottom: 5px;" id="w1-rata"></span>
                                                    <span style="font-size: 13px; color: #666;">Rata szacunkowa (<span class="months-display"></span> mies.)</span>
                                                </div>
                                            </td>
                                            
                                            <td width="4%" id="var-separator"></td>

                                            <td id="var2-container" valign="top" width="48%" style="background-color: #fdfdfd; border: 1px solid #dcebf7; border-top: 4px solid #28a745; border-radius: 8px; padding: 25px; box-shadow: 0 4px 15px rgba(0, 77, 153, 0.05);">
                                                <h3 style="margin-top: 0; font-size: 20px; color: #28a745; text-align: center; margin-bottom: 20px; font-weight: 700;">II WARIANT</h3>
                                                <table border="0" cellpadding="0" cellspacing="0" width="100%" style="font-size: 15px;">
                                                    <tr>
                                                        <td style="padding: 8px 0; border-bottom: 1px solid #eee; color: #666;">Kwota Netto:</td>
                                                        <td align="right" style="padding: 8px 0; border-bottom: 1px solid #eee; font-weight: 700; color: #333;" id="w2-net"></td>
                                                    </tr>
                                                    <tr>
                                                        <td style="padding: 8px 0; border-bottom: 1px solid #eee; color: #666;">Kwota Brutto:</td>
                                                        <td align="right" style="padding: 8px 0; border-bottom: 1px solid #eee; font-weight: 700; color: #333;" id="w2-gross"></td>
                                                    </tr>
                                                    <tr>
                                                        <td style="padding: 8px 0; border-bottom: 1px solid #eee; color: #666;">Prowizja bankowa:</td>
                                                        <td align="right" style="padding: 8px 0; border-bottom: 1px solid #eee; font-weight: 700; color: #28a745;" id="w2-prov"></td>
                                                    </tr>
                                                    <tr>
                                                        <td style="padding: 8px 0; border-bottom: 1px solid #eee; color: #666;">Marża banku:</td>
                                                        <td align="right" style="padding: 8px 0; border-bottom: 1px solid #eee; font-weight: 700; color: #333;" id="w2-margin"></td>
                                                    </tr>
                                                    <tr>
                                                        <td style="padding: 8px 0; border-bottom: 1px solid #eee; color: #666;">WIBOR 1M:</td>
                                                        <td align="right" style="padding: 8px 0; border-bottom: 1px solid #eee; font-weight: 700; color: #333;" class="wibor-val"></td>
                                                    </tr>
                                                    <tr>
                                                        <td style="padding: 10px 0; border-top: 1px solid #ddd; color: #666; font-weight: 700;">Oprocentowanie:</td>
                                                        <td align="right" style="padding: 10px 0; border-top: 1px solid #ddd; font-weight: 700; color: #333;" id="w2-rate"></td>
                                                    </tr>
                                                </table>
                                                
                                                <div style="font-size: 13px; color: #2e5c8a; background-color: #e8f4fd; padding: 12px; margin-top: 15px; border-radius: 4px; line-height: 1.5; border-left: 3px solid #0056b3;">
                                                    <strong>Warunek uzyskania wariantu:</strong><br>
                                                    Konsolidacja obecnego kredytu firmowego w Alior Banku 
                                                    <br><em>LUB</em><br>
                                                    Wnioskowanie dodatkowo o kredyt w rachunku bieżącym na jednym wniosku (kwota możliwa do pozyskania do 200 000 PLN - <strong>wnioskujemy o minimum 10 000 PLN limitu</strong>).
                                                </div>

                                                <div style="background-color: #f0fff4; border: 1px solid #c3e6cb; border-radius: 6px; padding: 15px; margin-top: 20px; text-align: center;">
                                                    <span style="display: block; font-size: 22px; font-weight: 700; color: #28a745; margin-bottom: 5px;" id="w2-rata"></span>
                                                    <span style="font-size: 13px; color: #666;">Rata szacunkowa (<span class="months-display"></span> mies.)</span>
                                                </div>
                                            </td>
                                        </tr>
                                    </table>

                                    <div id="bgk-section" style="background: #e6f7ff; border-left: 5px solid #007bff; padding: 20px; margin: 25px 0 0 0; border-radius: 0 8px 8px 0;">
                                        <p style="margin: 0; font-size: 16px; color: #333;"><strong>Gwarancja DE MINIMIS:</strong> W obu wariantach występuje Poręczenie BGK 0,5% od kwoty gwarancji (60% salda kredytu), płatne raz w roku przez 5 lat.</p>
                                    </div>
                                </div>

                                <div style="border-bottom: 1px solid #e0e0e0; padding-bottom: 30px; margin-bottom: 40px;">
                                    <h2 style="font-size: 24px; color: #004d99; border-bottom: 2px solid #007bff; padding-bottom: 10px; margin-bottom: 25px; font-weight: 700; margin-top: 0;">Kluczowe Korzyści</h2>
                                    <div id="dynamic-benefits-container"></div>
                                </div>

                                <div style="margin-bottom: 30px;">
                                    <h2 style="font-size: 24px; color: #004d99; border-bottom: 2px solid #007bff; padding-bottom: 10px; margin-bottom: 25px; font-weight: 700; margin-top: 0;">Wynagrodzenie za Doradztwo</h2>
                                    <p style="font-size: 17px; color: #555; margin-bottom: 20px;">Rozliczenie oparte o sukces (Success Fee), płatne dopiero po uruchomieniu środków.</p>
                                    
                                    <div style="background-color: #f8faff; border-radius: 8px; padding: 30px; border: 1px solid #e0e9f5; text-align: center;">
                                        <p style="margin: 0; padding: 0; font-size: 17px; color: #333;">Stawka za sukces</p>
                                        <span style="font-size: 32px; font-weight: 700; color: #28a745; display: block; margin: 15px 0;"><span id="fee-proc"></span> <span style="font-size: 16px; color: #555; font-weight: 400; vertical-align: middle;" id="fee-suffix"></span></span>
                                        <div style="border-top: 1px solid #c9dff7; margin-top: 20px; padding-top: 20px;">
                                            <p style="margin: 0; font-size: 18px; color: #333;">Kwota wynagrodzenia: <strong id="fee-kwota"></strong></p>
                                            <small style="color: #777; font-size: 14px; display: block; margin-top: 8px;">(liczone od kwoty pozyskanych środków)</small>
                                        </div>
                                    </div>
                                </div>
                                
                                <p style="margin-top: 40px; font-size: 17px; color: #555;">Czekam na <span id="client-decision-grammar">Pana</span> decyzję odnośnie wyboru wariantu, abyśmy mogli sprawnie przejść do procesowania wniosku.</p>
                                
                            </td>
                        </tr>
                    </table>

                </td>
            </tr>
        </table>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const storedData = localStorage.getItem('bafOfferData_V3');
            if (storedData) {
                const data = JSON.parse(storedData);

                // 1. TEKSTY OSOBOWE I WSTĘP
                document.getElementById('client-greeting').textContent = data.clientName + ",";
                document.getElementById('intro-paragraph').innerHTML = data.introText; // Używamy innerHTML aby ew. entery zachować? Textarea daje \n.
                // Textarea daje \n, html ignoruje \n. Zamieńmy \n na <br>
                document.getElementById('intro-paragraph').innerHTML = data.introText.replace(/\n/g, '<br>');

                // Klient (Pana/Pani decyzję)
                const genderClient = data.clientGender;
                if(genderClient === 'F') {
                    document.getElementById('client-decision-grammar').textContent = "Pani";
                } else {
                    document.getElementById('client-decision-grammar').textContent = "Pana";
                }

                // 2. WARIANTY UI
                if(!data.hasVariant2) {
                    document.getElementById('var2-container').style.display = 'none';
                    document.getElementById('var-separator').style.display = 'none';
                    document.getElementById('h3-var1').textContent = "OFERTA"; 
                }

                // 3. DANE LICZBOWE
                const fields = [
                    'w1-net', 'w1-gross', 'w1-prov', 'w1-margin', 'w1-rate', 'w1-rata',
                    'w2-net', 'w2-gross', 'w2-prov', 'w2-margin', 'w2-rate', 'w2-rata'
                ];
                fields.forEach(id => {
                    const el = document.getElementById(id);
                    if(el) {
                        // Pobieramy wartość ze struktury data.w1 lub data.w2
                        const parts = id.split('-');
                        const variant = parts[0] === 'w1' ? data.w1 : data.w2;
                        const keyMap = {
                            'net': 'netto', 'gross': 'brutto', 'prov': 'prowizja', 
                            'margin': 'marza', 'rate': 'oproc', 'rata': 'rata'
                        };
                        el.textContent = variant[keyMap[parts[1]]];
                    }
                });

                document.querySelectorAll('.months-display').forEach(el => el.textContent = data.months);
                document.querySelectorAll('.wibor-val').forEach(el => el.textContent = data.wibor + '%');

                // 4. BGK
                if(!data.showBGK) {
                    document.getElementById('bgk-section').style.display = 'none';
                } else {
                    if(!data.hasVariant2) {
                        const bgkText = document.querySelector('#bgk-section p');
                        bgkText.innerHTML = bgkText.innerHTML.replace("W obu wariantach", "W ofercie");
                    }
                }

                // 5. FEE
                const suffix = (data.vatType === 'VAT') ? '+ VAT' : 'zw. z VAT';
                document.getElementById('fee-proc').textContent = data.feeProc;
                document.getElementById('fee-suffix').textContent = suffix;
                document.getElementById('fee-kwota').textContent = data.feeKwota + " " + suffix;

                // 6. KORZYŚCI
                const benefitsContainer = document.getElementById('dynamic-benefits-container');
                let html = '<table border="0" cellpadding="0" cellspacing="0" width="100%">';
                
                const iconUrls = {
                    'wallet': 'https://img.icons8.com/ios/50/0056b3/wallet--v1.png',
                    'ok': 'https://img.icons8.com/ios/50/0056b3/ok--v1.png',
                    'unlock': 'https://img.icons8.com/ios/50/0056b3/unlock.png',
                    'discount': 'https://img.icons8.com/ios/50/0056b3/discount--v1.png',
                    'idea': 'https://img.icons8.com/ios/50/0056b3/idea.png',
                    'star': 'https://img.icons8.com/ios/50/0056b3/star.png',
                    'time': 'https://img.icons8.com/ios/50/0056b3/time.png',
                    'rocket': 'https://img.icons8.com/ios/50/0056b3/rocket.png',
                    'handshake': 'https://img.icons8.com/ios/50/0056b3/handshake.png',
                    'money': 'https://img.icons8.com/ios/50/0056b3/money-circulation.png'
                };

                data.benefits.forEach(ben => {
                    const iconSrc = iconUrls[ben.icon] || iconUrls['ok'];
                    html += `
                        <tr>
                            <td valign="top" width="50" style="padding-bottom: 25px;">
                                <img src="${iconSrc}" width="30" height="30" style="display: block;">
                            </td>
                            <td valign="top" style="padding-bottom: 25px;">
                                <div style="font-size: 17px; color: #555; line-height: 1.5;">
                                    ${ben.text}
                                </div>
                            </td>
                        </tr>
                    `;
                });
                
                html += '</table>';
                benefitsContainer.innerHTML = html;
            }
        });

        // KOPIOWANIE
        document.getElementById('copy-button').addEventListener('click', function() {
            const btn = this;
            const emailWrapper = document.getElementById('email-content-wrapper');
            const range = document.createRange();
            range.selectNode(emailWrapper);
            window.getSelection().removeAllRanges();
            window.getSelection().addRange(range);

            try {
                const htmlContent = emailWrapper.innerHTML;
                const blob = new Blob([htmlContent], { type: 'text/html' });
                const richTextInput = new ClipboardItem({ 'text/html': blob });
                
                if (typeof navigator.clipboard !== 'undefined' && navigator.clipboard.write) {
                    navigator.clipboard.write([richTextInput]).then(() => { successEffect(btn); });
                } else {
                    document.execCommand('copy');
                    successEffect(btn);
                }
            } catch (err) {
                document.execCommand('copy');
                successEffect(btn);
            }
            window.getSelection().removeAllRanges();
        });

        function successEffect(btn) {
            const originalText = 'Kopiuj całość do maila';
            const originalColor = '#17a2b8';
            btn.textContent = '✅ Skopiowano!';
            btn.style.backgroundColor = '#28a745';
            btn.classList.add('copied');
            setTimeout(() => {
                btn.textContent = originalText;
                btn.style.backgroundColor = originalColor;
                btn.classList.remove('copied');
            }, 2000);
        }
    </script>
</body>
</html>
