<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generator Umowy</title>
    
    <link rel="icon" type="image/png" href="baf_logo_p.png">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        /* =====================================
           BAF CALCULATOR UNIFIED DESIGN
           (Twoje style CSS - bez zmian)
        ===================================== */
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #2d3748;
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }
        .calc-header {
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 1rem 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .header-left-group { display: flex; align-items: center; gap: 1.5rem; }
        .header-center-group { font-size: 1.5rem; font-weight: 600; color: #1e293b; }
        .calc-brand { display: flex; align-items: center; gap: 1rem; }
        .calc-logo { height: 40px; width: 40px; border-radius: 8px; }
        .calc-title { font-size: 1.5rem; font-weight: 600; color: #1e293b; margin: 0; }
        .nav-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.6rem 1rem;
            background: #f1f5f9;
            color: #64748b;
            text-decoration: none;
            border-radius: 6px;
            transition: all 0.2s ease;
            font-weight: 500;
            border: none;
            cursor: pointer;
        }
        .nav-btn:hover { background: #1e40af; color: white; transform: translateY(-1px); }
        .calc-container { max-width: 800px; margin: 0 auto; padding: 0 1rem; }
        .calc-section {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            border: 1px solid #e2e8f0;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .section-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .section-title i { color: #1e40af; }
        .calc-table { width: 100%; border-collapse: collapse; }
        .calc-table td { padding: 0.75rem 0.5rem; border-bottom: 1px solid #f1f5f9; font-size: 0.9rem; vertical-align: middle; }
        .calc-table tr:last-child td { border-bottom: none; }
        .calc-table td:first-child { font-weight: 500; color: #374151; width: 40%; }
        .input-field {
            width: 100%;
            padding: 0.5rem 0.8rem;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            font-size: 0.9rem;
            background: #f8fafc;
            transition: all 0.2s ease;
            font-weight: 600;
        }
        .input-field:focus {
            outline: none;
            border-color: #1e40af;
            background: white;
            box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.1);
        }
        .calc-actions { margin-top: auto; padding-top: 1rem; border-top: 1px solid #e2e8f0; text-align: right; }
        .calc-btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: #1e40af;
            color: white;
        }
        .calc-btn:hover { background: #1e293b; }
        
        /* Spinner styles */
        #loader {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        #loader p {
            font-weight: 600;
            margin-top: 15px;
            color: #1e40af;
        }
        .spinner {
            border: 8px solid #f3f3f3;
            border-top: 8px solid #1e40af;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Styl dla kontenera odpowiedzi */
        #response-container {
            margin-top: 1.5rem;
            padding: 1.5rem;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            background: #f8fafc;
        }
    </style>
</head>
<body>
    <div id="loader">
        <div class="spinner"></div>
        <p>Generowanie dokumentu... To może potrwać do 30 sekund.</p>
    </div>

    <header class="calc-header">
        <div class="header-left-group">
            <div class="calc-brand">
                <i class="fas fa-file-signature calc-logo" style="background: #1e40af; color: white; padding: 10px; font-size: 20px;"></i>
                <h1 class="calc-title">Generator Umowy</h1>
            </div>
             <a href="proces_milosz_skd.html" class="nav-btn">
                <i class="fas fa-arrow-left"></i> Wróć do kalkulatora
            </a>
        </div>
        <div class="header-center-group">
            FORMULARZ
        </div>
        <div>
            <img src="baf_logo.png" alt="Logo BAF" style="height: 50px;">
        </div>
    </header>

    <main class="calc-container">
        <section class="calc-section">
            <h2 class="section-title"><i class="fas fa-keyboard"></i>Wprowadź dane do umowy</h2>
            
            <form id="contractForm">
                
                <table class="calc-table">
                    <tbody>
                        <tr>
                            <td>Imię i nazwisko klienta:</td>
                            <td><input type="text" id="imie_nazwisko" name="imie_nazwisko" class="input-field" required></td>
                        </tr>
                        <tr>
                            <td>Numer PESEL:</td>
                            <td><input type="text" id="pesel" name="pesel" class="input-field" required pattern="\d{11}" title="PESEL musi składać się z 11 cyfr"></td>
                        </tr>
                        <tr>
                            <td>Adres zamieszkania:</td>
                            <td><input type="text" id="adres" name="adres" class="input-field" required placeholder="np. ul. Wzorcowa 1/2, 00-001 Warszawa"></td>
                        </tr>
                        <tr>
                            <td>Nazwa banku:</td>
                            <td>
                                <select id="bank_select" name="bank_select" class="input-field" style="text-align: left;" required>
                                    <option value="" disabled selected>-- Wybierz bank --</option>
                                    <option value="PKO Bank Polski">PKO Bank Polski</option>
                                    <option value="Bank Pekao S.A.">Bank Pekao S.A.</option>
                                    <option value="Santander Bank Polska">Santander Bank Polska</option>
                                    <option value="ING Bank Śląski">ING Bank Śląski</option>
                                    <option value="mBank">mBank</option>
                                    <option value="BNP Paribas Bank Polska">BNP Paribas Bank Polska</option>
                                    <option value="Bank Millennium">Bank Millennium</option>
                                    <option value="Alior Bank">Alior Bank</option>
                                    <option value="Credit Agricole Bank Polska">Credit Agricole Bank Polska</option>
                                    <option value="VeloBank">VeloBank</option>
                                    <option value="Bank Handlowy (Citi Handlowy)">Bank Handlowy (Citi Handlowy)</option>
                                    <option value="Bank Pocztowy">Bank Pocztowy</option>
                                    <option value="BOŚ Bank (Bank Ochrony Środowiska)">BOŚ Bank (Bank Ochrony Środowiska)</option>
                                    <option value="Plus Bank">Plus Bank</option>
                                    <option value="Nest Bank">Nest Bank</option>
                                    <option value="Bank BPS (Bank Polskiej Spółdzielczości)">Bank BPS (Bank Polskiej Spółdzielczości)</option>
                                    <option value="SGB-Bank S.A. (Spółdzielcza Grupa Bankowa)">SGB-Bank S.A. (Spółdzielcza Grupa Bankowa)</option>
                                    <option value="Getin Noble Bank">Getin Noble Bank</option>
                                    <option value="Raiffeisen Bank Polska">Raiffeisen Bank Polska</option>
                                    <option value="Euro Bank">Euro Bank</option>
                                    <option value="Deutsche Bank Polska">Deutsche Bank Polska</option>
                                    <option value="Lukas Bank">Lukas Bank</option>
                                    <option value="GE Money Bank">GE Money Bank</option>
                                    <option value="Bank BPH">Bank BPH</option>
                                    <option value="Fortis Bank Polska">Fortis Bank Polska</option>
                                    <option value="Kredyt Bank">Kredyt Bank</option>
                                    <option value="BZ WBK">BZ WBK</option>
                                    <option value="Nordea Bank Polska">Nordea Bank Polska</option>
                                    <option value="Polbank EFG">Polbank EFG</option>
                                    <option value="Dominet Bank">Dominet Bank</option>
                                    <option value="Inny">Inny (wprowadź poniżej)</option>
                                </select>
                            </td>
                        </tr>
                        <tr id="inny_bank_row" style="display: none;">
                            <td></td> <td><input type="text" id="inny_bank" name="inny_bank" class="input-field" placeholder="Wpisz nazwę banku..."></td>
                        </tr>
                        <tr>
                            <td>Data podpisania umowy kredytowej:</td>
                            <td><input type="date" id="data_podpisania" name="data_podpisania" class="input-field" style="text-align: left;" required></td>
                        </tr>
                        <tr>
                            <td>Numer umowy kredytowej:</td>
                            <td><input type="text" id="nr_umowy" name="nr_umowy" class="input-field" required></td>
                        </tr>
                        <tr>
                            <td>Opłata początkowa (bez opłat sądowych):</td>
                            <td><input type="number" id="pre_oplata" name="pre_oplata" step="0.01" class="input-field" required placeholder="np. 1500.50"></td>
                        </tr>
                        <tr>
                            <td>Success fee (%):</td>
                            <td><input type="number" id="procent" name="procent" step="0.1" class="input-field" required placeholder="np. 15.5"></td>
                        </tr>
                    </tbody>
                </table>
                
                <div class="calc-actions">
                    <button type="submit" class="calc-btn">
                        <i class="fas fa-cogs"></i> GENERUJ UMOWĘ
                    </button>
                </div>
            </form>
            
            <div id="response-container" style="display: none;"></div>
            
        </section>
    </main>

    <script>
        // === POCZĄTEK ZMIAN ===

        // Stała z adresem URL Twojego wdrożonego skryptu
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbw871kr2UP9yQwCAXXA4CP3HlE9r7lwFT5V_hhgcX2iZIb19y7alcJs7U4ooruTiAd7/exec";

        // 1. Logika dla pola "Inny bank" (bez zmian)
        document.getElementById('bank_select').addEventListener('change', function() {
            var innyBankRow = document.getElementById('inny_bank_row');
            var innyBankInput = document.getElementById('inny_bank');
            
            if (this.value === 'Inny') {
                innyBankRow.style.display = 'table-row';
                innyBankInput.required = true;
            } else {
                innyBankRow.style.display = 'none';
                innyBankInput.required = false;
                innyBankInput.value = '';
            }
        });

        // 2. Nowa logika wysyłania formularza przy użyciu Fetch
        document.getElementById('contractForm').addEventListener('submit', function(e) {
            e.preventDefault(); // ZATRZYMUJEMY domyślne wysyłanie formularza
            
            var loader = document.getElementById('loader');
            var responseContainer = document.getElementById('response-container');
            var form = this; // 'this' odnosi się do formularza
            var btn = form.querySelector('button[type="submit"]');

            // Pokaż spinner i zablokuj przycisk
            loader.style.display = 'flex';
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Przetwarzanie...';

            // Wyczyść stare odpowiedzi
            responseContainer.innerHTML = '';
            responseContainer.style.display = 'none';

            var formData = new FormData(form);

            fetch(SCRIPT_URL, {
                method: 'POST',
                body: formData
            })
            .then(response => response.json()) // Oczekujemy odpowiedzi JSON
            .then(data => {
                loader.style.display = 'none'; // Ukryj spinner
                btn.disabled = false; // Odblokuj przycisk
                btn.innerHTML = '<i class="fas fa-cogs"></i> GENERUJ UMOWĘ';
                
                if (data.status === 'success') {
                    // Budujemy HTML z linkiem i przyciskiem
                    var successHtml = `
                        <h3 style="color: #16a34a;"><i class="fas fa-check-circle"></i> Sukces! Wygenerowano umowę.</h3>
                        <p>Link do dokumentu (<strong>${data.fileName}</strong>):</p>
                        <input type="text" id="docUrl" value="${data.url}" readonly class="input-field" style="margin-bottom: 10px;">
                        <a href="${data.url}" target="_blank" class="calc-btn" style="background-color: #1e40af; color: white; text-decoration: none; margin-right: 10px;">
                            <i class="fas fa-external-link-alt"></i> Otwórz dokument
                        </a>
                        <button onclick="copyLink()" class="calc-btn" style="background-color: #64748b;">
                            <i class="fas fa-copy"></i> Kopiuj link
                        </button>
                    `;
                    responseContainer.innerHTML = successHtml;
                    responseContainer.style.display = 'block';
                } else {
                    // Pokaż błąd
                    responseContainer.innerHTML = `<p style="color: red; font-weight: bold;">Wystąpił błąd: ${data.message}</p>`;
                    responseContainer.style.display = 'block';
                }
            })
            .catch(error => {
                // Obsługa błędów sieciowych
                loader.style.display = 'none';
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-cogs"></i> GENERUJ UMOWĘ';
                responseContainer.innerHTML = `<p style="color: red; font-weight: bold;">Błąd krytyczny: ${error.message}. Sprawdź konsolę (F12).</p>`;
                responseContainer.style.display = 'block';
                console.error('Błąd Fetch:', error);
            });
        });

        // 3. Funkcja do kopiowania linku (teraz używa nowszej, bezpieczniejszej metody)
        function copyLink() {
            var copyText = document.getElementById("docUrl");
            if (copyText && copyText.value) {
                navigator.clipboard.writeText(copyText.value)
                    .then(() => {
                        alert("Skopiowano link do schowka!");
                    })
                    .catch(err => {
                        console.error('Błąd kopiowania: ', err);
                        alert('Nie udało się skopiować linku. Spróbuj ręcznie.');
                    });
            }
        }
        
        // === KONIEC ZMIAN ===
    </script>
</body>
</html>
